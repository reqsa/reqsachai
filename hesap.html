<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Reqsa Chai - Hesap Detayları</title>
  <link rel="stylesheet" href="style.css" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet" />

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="firebase-config.js" defer></script>

  <style>
    main {
      max-width: 480px;
      margin: 80px auto;
      padding: 20px;
      background: #1a1a1a;
      border-radius: 12px;
      box-shadow: 0 8px 15px rgba(255, 255, 255, 0.1);
      color: #ccc;
      font-family: 'Poppins', sans-serif;
    }
    h2 {
      color: #fff;
      text-align: center;
      margin-bottom: 30px;
    }
    .detail-row {
      margin-bottom: 18px;
      font-size: 18px;
    }
    .label {
      font-weight: 600;
      color: #999;
    }
    button.logout-btn {
      display: block;
      margin: 30px auto 0;
      padding: 12px 20px;
      background-color: #e53935;
      border: none;
      border-radius: 8px;
      color: white;
      font-weight: 600;
      cursor: pointer;
      transition: background-color 0.3s ease;
      width: 100%;
    }
    button.logout-btn:hover {
      background-color: #b71c1c;
    }
  </style>
</head>
<body>
  <header class="navbar">
    <div class="logo">R.C.</div>
    <nav>
      <ul id="nav-links">
        <li><a href="index.html#hero">Ana Sayfa</a></li>
        <li><a href="iletisim.html">İletişim</a></li>
        <!-- Dinamik kullanıcı menüsü JS ile eklenecek -->
      </ul>
    </nav>
  </header>

  <main>
    <h2>Hesap Detayları</h2>
    <div class="detail-row">
      <span class="label">Kullanıcı Adı:</span>
      <span id="username">Yükleniyor...</span>
    </div>
    <div class="detail-row">
      <span class="label">E-posta:</span>
      <span id="email">Yükleniyor...</span>
    </div>
    <div>
      <h3 class="label">Bakiye: 0</h3>
    </div>
<br><br><br><br><br><br>
    <button class="logout-btn" id="logout-btn">Çıkış Yap</button>
  </main>

  <script>
    const navLinks = document.getElementById('nav-links');

    function setupNavbar(user) {
      // Temizle, 2 sabit link kalacak (Ana Sayfa, İletişim)
      while (navLinks.children.length > 2) {
        navLinks.removeChild(navLinks.lastChild);
      }

      if (user) {
        const username = user.email.split('@')[0];
        const userLi = document.createElement('li');
        userLi.classList.add('user-menu');
        userLi.innerHTML = `
          <a href="#" id="user-name">${username} ▼</a>
          <ul id="user-dropdown" class="dropdown-menu" style="display:none; position:absolute; top:100%; right:0; background:#1a1a1a; padding:10px 0; border-radius:8px; box-shadow: 0 8px 15px rgba(255,255,255,0.1); min-width:140px; list-style:none; z-index:100;">
            <li><a href="hesap.html">Hesap Detayları</a></li>
            <li><a href="#" id="logout-nav-btn">Çıkış Yap</a></li>
          </ul>
        `;
        navLinks.appendChild(userLi);

        const userNameLink = document.getElementById('user-name');
        const dropdown = document.getElementById('user-dropdown');

        userNameLink.addEventListener('click', (e) => {
          e.preventDefault();
          dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
        });

        document.addEventListener('click', (e) => {
          if (!userLi.contains(e.target)) {
            dropdown.style.display = 'none';
          }
        });

        document.getElementById('logout-nav-btn').addEventListener('click', async (e) => {
          e.preventDefault();
          await signOutAndRedirect();
        });
      } else {
        // Giriş yoksa login/register linkleri
        const loginLi = document.createElement('li');
        loginLi.innerHTML = `<a href="login.html">Giriş Yap</a>`;
        const registerLi = document.createElement('li');
        registerLi.innerHTML = `<a href="register.html">Kayıt Ol</a>`;

        navLinks.appendChild(loginLi);
        navLinks.appendChild(registerLi);
      }
    }

    async function signOutAndRedirect() {
      try {
        await auth.signOut();
        alert('Başarıyla çıkış yapıldı.');
        window.location.href = 'index.html';
      } catch (error) {
        alert('Çıkış yaparken hata oluştu: ' + error.message);
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      auth.onAuthStateChanged(user => {
        if (user) {
          document.getElementById('username').textContent = user.email.split('@')[0];
          document.getElementById('email').textContent = user.email;
          setupNavbar(user);
        } else {
          // Eğer giriş yoksa hesap sayfasına erişimi engellemek için ana sayfaya yönlendir
          window.location.href = 'login.html';
        }
      });

      document.getElementById('logout-btn').addEventListener('click', async () => {
        await signOutAndRedirect();
      });
    });
  </script>
</body>
</html>
